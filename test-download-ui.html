<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‹è½½æ¬¡æ•°UIå±•ç¤ºæµ‹è¯•</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        body {
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        .test-button {
            margin: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-button.warning {
            background: #ffc107;
            color: #212529;
        }
        .test-button.danger {
            background: #dc3545;
            color: white;
        }
        .demo-status {
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
        .demo-status.normal {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .demo-status.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .demo-status.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1><i class="fas fa-download"></i> ä¸‹è½½æ¬¡æ•°UIå±•ç¤ºæµ‹è¯•</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•ä¸‹è½½æ¬¡æ•°æ§åˆ¶åŠŸèƒ½çš„UIå±•ç¤ºæ•ˆæœã€‚</p>

        <!-- ä½¿ç”¨é‡æ˜¾ç¤ºåŒºåŸŸ -->
        <div class="test-section">
            <h2>ä½¿ç”¨é‡æ˜¾ç¤ºåŒºåŸŸ</h2>
            <div id="usage-display" class="usage-display">
                <!-- è¿™é‡Œä¼šåŠ¨æ€æ˜¾ç¤ºä½¿ç”¨é‡ä¿¡æ¯ -->
            </div>
        </div>

        <!-- ä¸‹è½½çŠ¶æ€æŒ‡ç¤ºå™¨æµ‹è¯• -->
        <div class="test-section">
            <h2>ä¸‹è½½çŠ¶æ€æŒ‡ç¤ºå™¨</h2>
            <div class="demo-status">
                <span class="download-status-indicator normal">
                    <i class="fas fa-check-circle"></i> æ­£å¸¸çŠ¶æ€
                </span>
            </div>
            <div class="demo-status warning">
                <span class="download-status-indicator warning">
                    <i class="fas fa-exclamation-triangle"></i> æ¥è¿‘é™åˆ¶
                </span>
            </div>
            <div class="demo-status error">
                <span class="download-status-indicator error">
                    <i class="fas fa-times-circle"></i> å·²è¾¾é™åˆ¶
                </span>
            </div>
        </div>

        <!-- åŠŸèƒ½æµ‹è¯•æŒ‰é’® -->
        <div class="test-section">
            <h2>åŠŸèƒ½æµ‹è¯•</h2>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•ä¸åŒçš„ä¸‹è½½é™åˆ¶æç¤ºç•Œé¢ï¼š</p>

            <button class="test-button" onclick="testNormalDownload()">
                <i class="fas fa-download"></i> æ¨¡æ‹Ÿæ­£å¸¸ä¸‹è½½
            </button>

            <button class="test-button warning" onclick="testNearDailyLimit()">
                <i class="fas fa-exclamation-triangle"></i> æ¨¡æ‹Ÿæ¥è¿‘æ—¥é™åˆ¶
            </button>

            <button class="test-button warning" onclick="testNearMonthlyLimit()">
                <i class="fas fa-exclamation-triangle"></i> æ¨¡æ‹Ÿæ¥è¿‘æœˆé™åˆ¶
            </button>

            <button class="test-button danger" onclick="testDailyLimitReached()">
                <i class="fas fa-times-circle"></i> æ¨¡æ‹Ÿè¾¾åˆ°æ—¥é™åˆ¶
            </button>

            <button class="test-button danger" onclick="testMonthlyLimitReached()">
                <i class="fas fa-times-circle"></i> æ¨¡æ‹Ÿè¾¾åˆ°æœˆé™åˆ¶
            </button>

            <button class="test-button danger" onclick="testBothLimitsReached()">
                <i class="fas fa-times-circle"></i> æ¨¡æ‹Ÿæ—¥é™åˆ¶éƒ½è¾¾åˆ°
            </button>

            <button class="test-button" onclick="testDownloadWarning()">
                <i class="fas fa-bell"></i> æµ‹è¯•ä¸‹è½½è­¦å‘Šé€šçŸ¥
            </button>

            <button class="test-button" onclick="resetUsageDisplay()">
                <i class="fas fa-redo"></i> é‡ç½®æ˜¾ç¤º
            </button>
        </div>

        <!-- å“åº”å¼è®¾è®¡æµ‹è¯• -->
        <div class="test-section">
            <h2>å“åº”å¼è®¾è®¡æµ‹è¯•</h2>
            <p>è¯·è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°æ¥æµ‹è¯•å“åº”å¼è®¾è®¡æ•ˆæœï¼š</p>
            <ul>
                <li>æ¡Œé¢ç«¯ï¼ˆ>768pxï¼‰ï¼šå®Œæ•´å¸ƒå±€æ˜¾ç¤º</li>
                <li>å¹³æ¿ç«¯ï¼ˆâ‰¤768pxï¼‰ï¼šæŒ‰é’®å‚ç›´æ’åˆ—ï¼Œå†…å®¹é€‚é…</li>
                <li>æ‰‹æœºç«¯ï¼ˆâ‰¤480pxï¼‰ï¼šä¼˜åŒ–å­—ä½“å¤§å°å’Œé—´è·</li>
            </ul>
        </div>

        <!-- å¯è®¿é—®æ€§æµ‹è¯• -->
        <div class="test-section">
            <h2>å¯è®¿é—®æ€§åŠŸèƒ½</h2>
            <p>æµ‹è¯•ä»¥ä¸‹å¯è®¿é—®æ€§åŠŸèƒ½ï¼š</p>
            <ul>
                <li><strong>é”®ç›˜å¯¼èˆª</strong>ï¼šä½¿ç”¨Tabé”®åœ¨æŒ‰é’®é—´åˆ‡æ¢</li>
                <li><strong>å±å¹•é˜…è¯»å™¨</strong>ï¼šæŒ‰é’®å’Œé“¾æ¥æœ‰é€‚å½“çš„ariaæ ‡ç­¾</li>
                <li><strong>å¯¹æ¯”åº¦</strong>ï¼šåœ¨é«˜å¯¹æ¯”åº¦æ¨¡å¼ä¸‹æ£€æŸ¥é¢œè‰²</li>
                <li><strong>å‡å°‘åŠ¨ç”»</strong>ï¼šåœ¨ç³»ç»Ÿçš„å‡å°‘åŠ¨ç”»åå¥½ä¸‹æµ‹è¯•</li>
            </ul>
        </div>

        <!-- æ·±è‰²æ¨¡å¼æµ‹è¯• -->
        <div class="test-section">
            <h2>æ·±è‰²æ¨¡å¼æµ‹è¯•</h2>
            <p>å¦‚æœç³»ç»Ÿæ”¯æŒæ·±è‰²æ¨¡å¼ï¼Œåˆ‡æ¢ç³»ç»Ÿä¸»é¢˜æ¥æµ‹è¯•æ·±è‰²æ¨¡å¼çš„æ˜¾ç¤ºæ•ˆæœã€‚</p>
        </div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„JavaScript -->
    <script src="js/config.js"></script>
    <script>
        // æ¨¡æ‹ŸUsageTrackerç±»ï¼ˆç®€åŒ–ç‰ˆæœ¬ç”¨äºæµ‹è¯•ï¼‰
        class MockUsageTracker {
            constructor() {
                this.config = {
                    dailyLimit: 10,
                    monthlyLimit: 300,
                    warningThreshold: 0.8
                };
                this.downloadConfig = {
                    dailyLimit: 5,
                    monthlyLimit: 150,
                    warningThreshold: 0.8
                };
                this.usageData = {
                    generation: {
                        daily: { count: 3, limit: this.config.dailyLimit },
                        monthly: { count: 45, limit: this.config.monthlyLimit }
                    },
                    download: {
                        daily: { count: 2, limit: this.downloadConfig.dailyLimit },
                        monthly: { count: 25, limit: this.downloadConfig.monthlyLimit }
                    }
                };
            }

            getUsage() {
                const daily = this.usageData.generation.daily;
                const monthly = this.usageData.generation.monthly;

                return {
                    daily: {
                        count: daily.count,
                        limit: daily.limit,
                        percentage: (daily.count / daily.limit) * 100
                    },
                    monthly: {
                        count: monthly.count,
                        limit: monthly.limit,
                        percentage: (monthly.count / monthly.limit) * 100
                    }
                };
            }

            getDownloadUsage() {
                const daily = this.usageData.download.daily;
                const monthly = this.usageData.download.monthly;

                return {
                    daily: {
                        count: daily.count,
                        limit: daily.limit,
                        percentage: (daily.count / daily.limit) * 100
                    },
                    monthly: {
                        count: monthly.count,
                        limit: monthly.limit,
                        percentage: (monthly.count / monthly.limit) * 100
                    }
                };
            }

            updateUsageDisplay() {
                const usage = this.getUsage();
                const downloadUsage = this.getDownloadUsage();

                // è®¡ç®—è¿›åº¦æ¡æ ·å¼ç±»
                let generationProgressClass = 'normal';
                if (usage.daily.percentage >= 100) {
                    generationProgressClass = 'error';
                } else if (usage.daily.percentage >= this.config.warningThreshold * 100) {
                    generationProgressClass = 'warning';
                }

                let downloadProgressClass = 'normal';
                if (downloadUsage.daily.percentage >= 100) {
                    downloadProgressClass = 'error';
                } else if (downloadUsage.daily.percentage >= this.downloadConfig.warningThreshold * 100) {
                    downloadProgressClass = 'warning';
                }

                const usageElement = document.getElementById('usage-display');
                if (usageElement) {
                    usageElement.innerHTML = `
                        <div class="usage-info">
                            <div class="usage-section">
                                <span class="usage-daily">ç”Ÿæˆ: ${usage.daily.count}/${usage.daily.limit}</span>
                                <span class="usage-monthly">æœ¬æœˆ: ${usage.monthly.count}/${usage.monthly.limit}</span>
                            </div>
                            <div class="usage-section">
                                <span class="download-daily">ä¸‹è½½: ${downloadUsage.daily.count}/${downloadUsage.daily.limit}</span>
                                <span class="download-monthly">æœ¬æœˆ: ${downloadUsage.monthly.count}/${downloadUsage.monthly.limit}</span>
                            </div>
                        </div>
                        <div class="usage-progress-container">
                            <div class="usage-progress-bar generation ${generationProgressClass}" style="width: ${usage.daily.percentage}%" title="ç”Ÿæˆè¿›åº¦: ${usage.daily.count}/${usage.daily.limit}"></div>
                            <div class="usage-progress-bar download ${downloadProgressClass}" style="width: ${downloadUsage.daily.percentage}%" title="ä¸‹è½½è¿›åº¦: ${downloadUsage.daily.count}/${downloadUsage.daily.limit}"></div>
                        </div>
                    `;

                    // æ·»åŠ è­¦å‘Šæ ·å¼
                    if (downloadUsage.daily.percentage >= 100) {
                        usageElement.classList.add('download-limit-reached');
                    } else if (downloadUsage.daily.percentage >= this.downloadConfig.warningThreshold * 100) {
                        usageElement.classList.add('download-near-limit');
                    } else {
                        usageElement.classList.remove('download-near-limit', 'download-limit-reached');
                    }
                }
            }

            // å…¶ä»–æ–¹æ³•çš„æ¨¡æ‹Ÿå®ç°...
            showDownloadLimitModal(downloadUsage, isDailyLimit, isMonthlyLimit) {
                // å®ç°ä¸çœŸå®UsageTrackerç›¸åŒçš„æ¨¡æ€æ¡†æ˜¾ç¤ºé€»è¾‘
                console.log('æ˜¾ç¤ºä¸‹è½½é™åˆ¶æ¨¡æ€æ¡†:', { downloadUsage, isDailyLimit, isMonthlyLimit });
            }
        }

        // åˆ›å»ºæ¨¡æ‹Ÿçš„UsageTrackerå®ä¾‹
        const mockTracker = new MockUsageTracker();

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–æ˜¾ç¤º
        document.addEventListener('DOMContentLoaded', function() {
            mockTracker.updateUsageDisplay();
        });

        // æµ‹è¯•å‡½æ•°
        function testNormalDownload() {
            mockTracker.usageData.download.daily.count = 2;
            mockTracker.usageData.download.monthly.count = 25;
            mockTracker.updateUsageDisplay();
            showNotification('æ¨¡æ‹Ÿæ­£å¸¸ä¸‹è½½çŠ¶æ€', 'success');
        }

        function testNearDailyLimit() {
            mockTracker.usageData.download.daily.count = 4; // æ¥è¿‘5çš„é™åˆ¶
            mockTracker.updateUsageDisplay();
            showNotification('æ¨¡æ‹Ÿæ¥è¿‘æ—¥é™åˆ¶çŠ¶æ€', 'warning');
        }

        function testNearMonthlyLimit() {
            mockTracker.usageData.download.daily.count = 2;
            mockTracker.usageData.download.monthly.count = 120; // æ¥è¿‘150çš„é™åˆ¶
            mockTracker.updateUsageDisplay();
            showNotification('æ¨¡æ‹Ÿæ¥è¿‘æœˆé™åˆ¶çŠ¶æ€', 'warning');
        }

        function testDailyLimitReached() {
            // æ¨¡æ‹Ÿæ—¥é™åˆ¶è¾¾åˆ°æ—¶çš„æ¨¡æ€æ¡†
            showModal(
                'download-limit-modal',
                'ä¸‹è½½é™åˆ¶',
                `<div class="download-limit-info">
                    <div class="download-limit-row">
                        <span class="label">ä»Šæ—¥ä¸‹è½½ï¼š</span>
                        <span class="value exceeded">5/5</span>
                    </div>
                    <div class="download-limit-progress">
                        <div class="download-limit-progress-bar">
                            <div class="download-limit-progress-fill" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                <div class="download-limit-message">
                    <p><strong style="color: var(--warning-color);">ä»Šæ—¥ä¸‹è½½æ¬¡æ•°å·²è¾¾ä¸Šé™</strong></p>
                    <p>ğŸ“… æ¯æ—¥é…é¢ï¼šæ˜æ—¥å‡Œæ™¨è‡ªåŠ¨é‡ç½®</p>
                    <p>ğŸ”„ å½“å‰ä¸‹è½½é…é¢ï¼š5æ¬¡/å¤©</p>
                </div>`,
                `<button class="download-limit-btn secondary" onclick="closeModal('download-limit-modal')">
                    <i class="fas fa-times"></i> çŸ¥é“äº†
                </button>
                <button class="download-limit-btn primary" onclick="closeModal('download-limit-modal')">
                    <i class="fas fa-chart-bar"></i> æŸ¥çœ‹è¯¦æƒ…
                </button>`
            );
        }

        function testMonthlyLimitReached() {
            showModal(
                'download-limit-modal',
                'ä¸‹è½½é™åˆ¶',
                `<div class="download-limit-info">
                    <div class="download-limit-row">
                        <span class="label">ä»Šæ—¥ä¸‹è½½ï¼š</span>
                        <span class="value">3/5</span>
                    </div>
                    <div class="download-limit-progress">
                        <div class="download-limit-progress-bar">
                            <div class="download-limit-progress-fill" style="width: 60%"></div>
                        </div>
                    </div>
                    <div class="download-limit-row">
                        <span class="label">æœ¬æœˆä¸‹è½½ï¼š</span>
                        <span class="value exceeded">150/150</span>
                    </div>
                    <div class="download-limit-progress">
                        <div class="download-limit-progress-bar">
                            <div class="download-limit-progress-fill" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                <div class="download-limit-message">
                    <p><strong style="color: var(--warning-color);">æœ¬æœˆä¸‹è½½æ¬¡æ•°å·²è¾¾ä¸Šé™</strong></p>
                    <p>ğŸ“… æœˆåº¦é…é¢ï¼šä¸‹æœˆ1å·è‡ªåŠ¨é‡ç½®</p>
                    <p>ğŸ”„ å½“å‰æœˆåº¦é…é¢ï¼š150æ¬¡/æœˆ</p>
                </div>`,
                `<button class="download-limit-btn secondary" onclick="closeModal('download-limit-modal')">
                    <i class="fas fa-times"></i> çŸ¥é“äº†
                </button>`
            );
        }

        function testBothLimitsReached() {
            showModal(
                'download-limit-modal',
                'ä¸‹è½½é™åˆ¶',
                `<div class="download-limit-info">
                    <div class="download-limit-row">
                        <span class="label">ä»Šæ—¥ä¸‹è½½ï¼š</span>
                        <span class="value exceeded">5/5</span>
                    </div>
                    <div class="download-limit-progress">
                        <div class="download-limit-progress-bar">
                            <div class="download-limit-progress-fill" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="download-limit-row">
                        <span class="label">æœ¬æœˆä¸‹è½½ï¼š</span>
                        <span class="value exceeded">150/150</span>
                    </div>
                    <div class="download-limit-progress">
                        <div class="download-limit-progress-bar">
                            <div class="download-limit-progress-fill" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                <div class="download-limit-message">
                    <p><strong style="color: var(--error-color);">ä»Šæ—¥å’Œæœ¬æœˆä¸‹è½½æ¬¡æ•°å‡å·²è¾¾åˆ°ä¸Šé™</strong></p>
                    <p>ğŸ“… ä»Šæ—¥é…é¢ï¼šæ˜æ—¥å‡Œæ™¨è‡ªåŠ¨é‡ç½®</p>
                    <p>ğŸ“… æœ¬æœˆé…é¢ï¼šä¸‹æœˆ1å·è‡ªåŠ¨é‡ç½®</p>
                </div>`,
                `<button class="download-limit-btn secondary" onclick="closeModal('download-limit-modal')">
                    <i class="fas fa-times"></i> çŸ¥é“äº†
                </button>`
            );
        }

        function testDownloadWarning() {
            showDownloadWarningNotification('æ‚¨çš„ä¸‹è½½æ¬¡æ•°å³å°†è¾¾åˆ°é™åˆ¶ï¼Œè¯·æ³¨æ„åˆç†ä½¿ç”¨ã€‚');
        }

        function resetUsageDisplay() {
            mockTracker.usageData.download.daily.count = 2;
            mockTracker.usageData.download.monthly.count = 25;
            mockTracker.updateUsageDisplay();
            showNotification('ä½¿ç”¨é‡æ˜¾ç¤ºå·²é‡ç½®', 'info');
        }

        // è¾…åŠ©å‡½æ•°
        function showModal(modalClass, title, bodyContent, actionsContent) {
            // ç§»é™¤å·²å­˜åœ¨çš„æ¨¡æ€æ¡†
            const existingModal = document.querySelector(`.${modalClass}`);
            if (existingModal) {
                existingModal.remove();
            }

            const modal = document.createElement('div');
            modal.className = `modal ${modalClass} fade show`;
            modal.style.display = 'block';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.setAttribute('tabindex', '-1');
            modal.setAttribute('role', 'dialog');

            const modalHTML = `
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="fas fa-download download-limit-icon"></i>
                                ${title}
                            </h5>
                        </div>
                        <div class="modal-body">
                            ${bodyContent}
                        </div>
                        <div class="modal-footer">
                            <div class="download-limit-actions">
                                ${actionsContent}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            modal.innerHTML = modalHTML;
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';

            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal(modalClass);
                }
            });
        }

        function closeModal(modalClass) {
            const modal = document.querySelector(`.${modalClass}`);
            if (modal) {
                modal.remove();
                document.body.style.overflow = '';
            }
        }

        function showDownloadWarningNotification(message) {
            // ç§»é™¤å·²å­˜åœ¨çš„ä¸‹è½½è­¦å‘Šé€šçŸ¥
            const existingWarning = document.querySelector('.download-warning-notification');
            if (existingWarning) {
                existingWarning.remove();
            }

            const notification = document.createElement('div');
            notification.className = 'download-warning-notification';
            notification.innerHTML = `
                <div class="download-warning-content">
                    <div class="download-warning-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="download-warning-text">
                        <div class="download-warning-title">ä¸‹è½½é™åˆ¶æé†’</div>
                        <div class="download-warning-message">${message}</div>
                    </div>
                    <button class="download-warning-close" onclick="this.closest('.download-warning-notification').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;

            document.body.appendChild(notification);

            // è‡ªåŠ¨ç§»é™¤é€šçŸ¥
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 8000);
        }

        function showNotification(message, type = 'info') {
            // ç®€å•çš„é€šçŸ¥æ˜¾ç¤º
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem;
                background: ${type === 'success' ? '#d4edda' : type === 'warning' ? '#fff3cd' : type === 'error' ? '#f8d7da' : '#d1ecf1'};
                color: ${type === 'success' ? '#155724' : type === 'warning' ? '#856404' : type === 'error' ? '#721c24' : '#0c5460'};
                border-radius: 4px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.15);
                z-index: 9999;
                max-width: 300px;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>